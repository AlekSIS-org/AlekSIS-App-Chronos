{% include 'partials/header.html' %}
<script type="text/javascript">
    {% if smart %}
        function goToCalendarWeek(cw) {
            window.location.href = "{% url "timetable_smart_plan" raw_type id "smart" %}/{{ selected_year }}/" + cw;
        }
        function onCalendarWeekChanged() {
            goToCalendarWeek($("#calendar-week").val());
        }

        $(document).ready(function () {
            $("#calendar-week").change(onCalendarWeekChanged);
        });
    {% endif %}
</script>
<main>
    <div class="row">
        <div class="col s12 m6 l8 xl9">
            <h3>
                Stundenplan <i>{{ el }}</i>
            </h3>


        </div>
        <div class=" col s12 m6 l4 xl3 right align-right">
            <a class="waves-effect waves-teal btn-flat btn-flat-medium right" id="print">
                <i class="material-icons center">print</i>
            </a>
        </div>
    </div>
    <div class="row">
        {% if smart %}
            <div class="col s12 m6">
                <p class="left" style="margin: 0;"><span
                        class="badge new primary-color left-align">SMART PLAN</span>
                </p>&nbsp;

                <a class="waves-effect waves-light btn" href="{% url "timetable_plan" raw_type id %}">
                    <i class="material-icons left">slideshow</i>
                    Regelplan anzeigen
                </a>
            </div>

            <div class="input-field col s12 m6 right">
                <select id="calendar-week">
                    {% for week in weeks %}
                        <option value="{{ week.calendar_week }}" {% if week.calendar_week == selected_week %}
                                selected {% endif %}>
                            KW {{ week.calendar_week }}
                            ({{ week.first_day|date:"j. F Y" }}â€“{{ week.last_day|date:"j. F Y" }})
                        </option>
                    {% endfor %}
                </select>
            </div>

        {% else %}
            <a class="waves-effect waves-light btn"
               href="{% url "timetable_smart_plan" raw_type id "smart" %}">
                <i class="material-icons left">slideshow</i>
                SMART PLAN
            </a>
        {% endif %}
    </div>
    <div class="timetable-plan">
        <div class="row">
            <div class="col s2">

            </div>
            <div class="col s2">
                <div class="card timetable-title-card">
                    <div class="card-content">
                    <span class="card-title">
                        Montag
                    </span>
                    </div>
                </div>
            </div>
            <div class="col s2">
                <div class="card timetable-title-card">
                    <div class="card-content">
                    <span class="card-title">
                        Dienstag
                    </span>
                    </div>
                </div>
            </div>
            <div class="col s2">
                <div class="card timetable-title-card">
                    <div class="card-content">
                    <span class="card-title">
                        Mittwoch
                    </span>
                    </div>
                </div>
            </div>
            <div class="col s2">
                <div class="card timetable-title-card">
                    <div class="card-content">
                    <span class="card-title">
                        Donnerstag
                    </span>
                    </div>
                </div>
            </div>
            <div class="col s2">
                <div class="card timetable-title-card">
                    <div class="card-content">
                    <span class="card-title">
                        Freitag
                    </span>
                    </div>
                </div>
            </div>

        </div>
        {% for row, time in plan %}
            <div class="row">
                <div class="col s2">
                    <div class="card timetable-title-card">
                        <div class="card-content">

                            {# Lesson number #}
                            <span class="card-title left">
                                {{ time.number_format }}
                             </span>

                            {# Time dimension of lesson #}
                            <div class="right timetable-time grey-text text-darken-2">
                                <span>{{ time.start|date:"H:i" }}</span><br>
                                <span>{{ time.end|date:"H:i" }}</span>
                            </div>
                        </div>
                    </div>

                </div>
                {% for col in row %}
                    {# A lesson #}
                    <div class="col s2">
                        <div class="card lesson-card">
                            <div class="card-content">

                                {# Every element of the lesson #}
                                {% for element_container in col.elements %}
                                    <div style="
                                            {# Display background color only if no badge exists and it is not the old room #}
                                            {% if not element_container.substitution.table.badge %}
                                                {% if not element_container.is_old or type != 1 %}
                                                    background-color: {{ element_container.element.subject.hex_color }};
                                                {% endif %}
                                            {% endif %}"

                                            {# Add CSS class for sub when it's a sub #}
                                         class="{% if element_container.substitution %}lesson-with-sub{% endif %}">
                                        <p>
                                            {% if element_container.substitution %}
                                                {# SUBSTITUTION #}

                                                {% if type == 1 and element_container.is_old %}
                                                    {# When it's the old room, let it empty #}

                                                {% elif element_container.substitution.table.badge %}
                                                    {# When a badge (cancellation, etc.) exists, then display it #}
                                                    <span class="badge new green darken-2">{{ element_container.substitution.table.badge }}</span>


                                                {% else %}
                                                    {# Display sub #}

                                                    {# Teacher or room > display classes #}
                                                    {% if type == 0 or type == 1 %}
                                                        {{ element_container.substitution.table.classes }}
                                                    {% endif %}

                                                    {# Display teacher with tooltip #}
                                                    <span class="tooltipped" data-position="bottom"
                                                          data-tooltip="{{ element_container.substitution.table.teacher_full|safe }}">{{ element_container.substitution.table.teacher|safe }}</span>

                                                    {# Display subject #}
                                                    {{ element_container.substitution.table.subject|safe }}

                                                    {# Teacher or class > display room #}
                                                    {% if type == 0 or type == 2 %}
                                                        <span class="tooltipped" data-position="bottom"
                                                              data-tooltip="{{ element_container.substitution.table.room_full|safe }}">{{ element_container.substitution.table.room|safe }}</span>
                                                    {% endif %}
                                                {% endif %}<br>

                                                {# When it isn't a room or the old plan, then display the extra text (e. g. work orders)#}
                                                {% if not type == 1 or not element_container.is_old %}
                                                    <small>
                                                        <em>{{ element_container.substitution.table.text|default:"" }}</em>
                                                    </small>
                                                {% endif %}


                                            {% else %}
                                                {# Normal plan #}

                                                {# Teacher or room > Display classes #}
                                                {% if type == 0 or type == 1 %}
                                                    {% for class in element_container.element.classes %}
                                                        {{ class.name }}
                                                    {% endfor %}
                                                {% endif %}

                                                {# Class or room > Display teacher #}
                                                {% if type == 2 or type == 1 %}
                                                    <span data-position="bottom" class="tooltipped"
                                                          data-tooltip="{{ element_container.element.teacher }}">{{ element_container.element.teacher.shortcode }}</span>
                                                {% endif %}

                                                {# Display subject #}
                                                <strong>{{ element_container.element.subject.shortcode }}</strong>

                                                {# Teacher or class > Display room #}
                                                {% if type == 0 or type == 2 %}
                                                    <span class="tooltipped" data-position="bottom"
                                                          data-tooltip="{{ element_container.room.name }}">{{ element_container.room.shortcode }}</span>
                                                {% endif %}
                                            {% endif %}
                                        </p>
                                    </div>

                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
</main>

{% include 'partials/footer.html' %}
